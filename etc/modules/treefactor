#!/usr/bin/emacs --script

(use-package treefactor
  :straight t
  :config
  (setq treefactor-inbox-file-header "** Inbox.org\n:PROPERTIES:\n:VISIBILITY: children\n:END:\n\n")
  (setq treefactor-org-agenda-dir nil)
  (setq user-home-directory "~/")

  (defhydra as/refile ()
  ("1" as/treefactor-agenda "Agenda")
  ("2" as/treefactor-linked "Linked")
  ("3" as/treefactor-dashboard "Dashboard")
  ("o" other-window "Other Window")
  ("SPC" treefactor-throw "Throw")
  ("RET" dired-find-file "Find File")
  ("<up>" dired-previous-line "Previous Line")
  ("<down>" dired-next-line "Next Line")
  ("<backspace>" dired-up-directory "Up dir")
  ("<tab>" org-cycle "cycle")
  ("u" treefactor-up "Throw Up")
  ("k" org-cut-subtree "Cut Subtree")
  ("q" nil "cancel" :exit t))

  (defun as/process-hud-inbox()
    (interactive)
    (find-file "~/HUD/Inbox.org")
    (goto-char (point-min))
    (outline-next-heading)
    (as/refile/body))

  (defun as/process-file()
    (interactive)
    (find-file "~/HUD/process.org")
    (goto-char (point-min))
    (outline-next-heading)
    (outline-next-heading)
    (outline-next-heading)
    (as/refile/body))



  (defun as/treefactor-agenda ()
    (interactive)
    (delete-other-windows)
    (goto-char (point-min))
    (org-next-visible-heading 1)
    (if (file-equal-p (substring (directory-file-name buffer-file-truename) 0 22 ) "~/1-Personal/1-Agenda")
        (dired-other-window "~/1-Personal/1-Agenda")
      (other-window -1))
    (if (file-equal-p (substring (directory-file-name buffer-file-truename) 0 18 ) "~/2-Work/1-Agenda")
        (dired-other-window "~/2-Work/1-Agenda")
      (other-window -1)))


  (defun as/treefactor-dashboard ()
    (interactive)
    (delete-other-windows)
    (goto-char (point-min))
    (org-next-visible-heading 1)
    (find-file-other-window "~/HUD/dashboard.org")
    (other-window -1))

  (defun as/treefactor-linked ()
    (interactive)
    (delete-other-windows)
    (goto-char (point-min))
    (org-next-visible-heading 1)
    (if (file-equal-p (substring (directory-file-name buffer-file-truename) 0 22 ) "~/1-Personal/2-Linked")
        (dired-other-window "~/1-Personal/2-Linked")
      (other-window -1))
    (if (file-equal-p (substring (directory-file-name buffer-file-truename) 0 22 ) "~/2-Work/2-Linked")
        (dired-other-window "~/2-Work/2-Linked")
      (other-window -1)))

  )
