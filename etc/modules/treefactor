#!/usr/bin/emacs --script

(use-package treefactor
  :straight t
  :config
  (setq treefactor-inbox-file-header "** Inbox.org\n:PROPERTIES:\n:VISIBILITY: children\n:END:\n\n")
  (setq treefactor-org-agenda-dir nil)
  (setq user-home-directory "~/")

  (defhydra as/refile-hydra (:color pink)
    "
    ^
    ^Dired^               ^Refile^           ^Actions^
    ^─────^────────────────^──^──────────────────^──^─────
    _1_ Personal Agenda   _SPC_ Throw...    _t_ Todo...
    _2_ Personal Linked   _u_ Refile up     _s_ Schedule...
    _3_ Work Agenda                       _d_ Deadline...
    _4_ Work Linked                       _k_ Cut
    _j_ Dired Jump                        _S_ Save...
                                        _f_ Filter...
                                        _a_ Add to working set...
    ^^
    ^^
    ^^
    ^^
    ^^                  ^^
    "
    ("1" as/refile-to-personal-agenda)
    ("2" as/refile-to-personal-linked)
    ("3" as/refile-to-work-agenda)
    ("4" as/refile-to-work-linked)
    ("j" as/dired-jump-other-window)

    ("SPC" treefactor-throw)
    ("u" treefactor-up)

    ("t" org-todo)
    ("s" org-schedule)
    ("d" org-deadline)
    ("k" org-cut-subtree)
    ("S" org-save-all-org-buffers)
    ("a" (call-interactively 'as/working-set-add))
    ("f" (call-interactively 'org-ql-sparse-tree))

    ("<up>" dired-previous-line)
    ("<down>" dired-next-line)
    ("o" other-window)
    ("RET" dired-find-file)
    ("^" dired-up-directory)
    ("<tab>" org-cycle)

    ("q" nil "cancel" :exit t))

  (defun as/treefactor-dashboard ()
    (interactive)
    (delete-other-windows)
    (goto-char (point-min))
    (org-next-visible-heading 1)
    (find-file-other-window "~/HUD/dashboard.org")
    (other-window -1))

  (defun as/process-hud-inbox()
    (interactive)
    (find-file "~/HUD/Inbox.org")
    (goto-char (point-min))
    (outline-next-heading)
    (as/refile-hydra/body))

  (defun as/process-file()
    (interactive)
    (find-file "~/HUD/process.org")
    (goto-char (point-min))
    (outline-next-heading)
    (outline-next-heading)
    (outline-next-heading)
    (as/refile-hydra/body))

  (defun as/refile-to-personal-agenda ()
    (interactive)
    (delete-other-windows)
    (dired-other-window "~/1-Personal/1-Agenda")
    (other-window -1))

  (defun as/refile-to-work-agenda ()
    (interactive)
    (delete-other-windows)
    (dired-other-window "~/2-Work/1-Agenda")
    (other-window -1))

  (defun as/refile-to-personal-linked ()
    (interactive)
    (delete-other-windows)
    (dired-other-window "~/1-Personal/2-Linked")
    (other-window -1))

  (defun as/refile-to-work-linked ()
    (interactive)
    (delete-other-windows)
    (dired-other-window "~/2-Work/2-Linked")
    (other-window -1))

  (defun as/dired-jump-other-window ()
    (interactive)
    (dired-jump-other-window)
    (other-window -1))

  )
